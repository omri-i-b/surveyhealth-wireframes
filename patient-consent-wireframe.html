<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consent Pending - Patient Ticket</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
  </style>
  <!-- Tailwind safelist (hidden, forces class generation) -->
  <div class="hidden border-green-200 border-red-200 border-yellow-200 border-orange-200 bg-green-100 bg-red-100 bg-yellow-100 bg-orange-100 text-green-600 text-red-600 text-yellow-600 text-orange-600"></div>
</head>
<body class="bg-gray-50 text-gray-900">

  <!-- Modal Backdrop -->
  <div id="modalBackdrop" class="fixed inset-0 bg-black/50 z-40 hidden" onclick="closeAllModals()"></div>

  <!-- Edit/Add Phone Modal -->
  <div id="phoneModal" class="fixed inset-0 z-50 hidden items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-xs mx-4" onclick="event.stopPropagation()">
      <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200">
        <h3 id="phoneModalTitle" class="font-semibold text-gray-900 text-sm">Add Phone Number</h3>
        <button onclick="closePhoneModal()" class="p-1 hover:bg-gray-100 rounded">
          <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="p-4 space-y-3">
        <div>
          <label class="text-xs font-medium text-gray-700 block mb-1">Phone Number</label>
          <input type="tel" id="phoneInput" placeholder="(555) 555-5555" class="w-full px-3 py-2 text-sm border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
          <label class="text-xs font-medium text-gray-700 block mb-1">Type</label>
          <div class="flex gap-4">
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="phoneType" value="cell" checked class="w-4 h-4 text-blue-600">
              <span class="text-sm text-gray-900">Cell</span>
            </label>
            <label class="flex items-center gap-2 cursor-pointer">
              <input type="radio" name="phoneType" value="landline" class="w-4 h-4 text-blue-600">
              <span class="text-sm text-gray-900">Landline</span>
            </label>
          </div>
        </div>
        <label class="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" id="phonePrimary" class="w-4 h-4 text-blue-600 rounded">
          <span class="text-sm text-gray-700">Set as primary</span>
        </label>
      </div>
      <div class="flex justify-end gap-2 px-4 py-3 border-t border-gray-200 bg-gray-50 rounded-b-lg">
        <button onclick="closePhoneModal()" class="px-3 py-1.5 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded">Cancel</button>
        <button onclick="savePhone()" class="px-3 py-1.5 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded">Save</button>
      </div>
    </div>
  </div>

  <!-- Log Manual Call Modal -->
  <div id="logCallModal" class="fixed inset-0 z-50 hidden items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4" onclick="event.stopPropagation()">
      <!-- Modal Header -->
      <div class="flex items-center justify-between px-4 py-3 border-b border-gray-200">
        <h3 class="font-semibold text-gray-900">Log Call</h3>
        <button onclick="closeModal()" class="p-1 hover:bg-gray-100 rounded">
          <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- Modal Body -->
      <div class="p-4 space-y-4">
        <!-- Call Outcome -->
        <div>
          <label class="text-xs font-medium text-gray-700 block mb-2">Call Outcome *</label>
          <div class="grid grid-cols-2 gap-2">
            <label class="flex items-center gap-2 px-3 py-2 border border-gray-200 rounded cursor-pointer hover:bg-gray-50 has-[:checked]:bg-blue-50 has-[:checked]:border-blue-300">
              <input type="radio" name="call_status" value="reached" class="text-blue-600" checked onchange="toggleTimeSection()">
              <span class="text-sm">Reached</span>
            </label>
            <label class="flex items-center gap-2 px-3 py-2 border border-gray-200 rounded cursor-pointer hover:bg-gray-50 has-[:checked]:bg-blue-50 has-[:checked]:border-blue-300">
              <input type="radio" name="call_status" value="no_answer" class="text-blue-600" onchange="toggleTimeSection()">
              <span class="text-sm">No Answer</span>
            </label>
            <label class="flex items-center gap-2 px-3 py-2 border border-gray-200 rounded cursor-pointer hover:bg-gray-50 has-[:checked]:bg-blue-50 has-[:checked]:border-blue-300">
              <input type="radio" name="call_status" value="voicemail" class="text-blue-600" onchange="toggleTimeSection()">
              <span class="text-sm">Voicemail</span>
            </label>
            <label class="flex items-center gap-2 px-3 py-2 border border-gray-200 rounded cursor-pointer hover:bg-gray-50 has-[:checked]:bg-blue-50 has-[:checked]:border-blue-300">
              <input type="radio" name="call_status" value="wrong_number" class="text-blue-600" onchange="toggleTimeSection()">
              <span class="text-sm">Wrong Number</span>
            </label>
          </div>
        </div>

        
        
        <!-- Time (hidden for no answer/voicemail) -->
        <div id="timeSection" class="flex gap-3 items-end">
          <div class="flex-1">
            <label class="text-xs font-medium text-gray-700 block mb-2">Start</label>
            <input type="time" id="startTime" class="w-full px-3 py-2 text-sm border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
          <div class="flex-1">
            <label class="text-xs font-medium text-gray-700 block mb-2">End</label>
            <input type="time" id="endTime" class="w-full px-3 py-2 text-sm border border-gray-200 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>
        </div>

        <!-- Notes -->
        <div>
          <label class="text-xs font-medium text-gray-700 block mb-2">Notes <span class="text-gray-400 font-normal">(optional)</span></label>
          <textarea
            id="callNotes"
            class="w-full px-3 py-2 text-sm border border-gray-200 rounded resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            rows="2"
            placeholder="Add any notes..."
          ></textarea>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="flex items-center justify-between px-4 py-3 border-t border-gray-200 bg-gray-50 rounded-b-lg">
        <span class="text-xs text-gray-400">Press Enter to submit</span>
        <div class="flex gap-2">
          <button onclick="closeModal()" class="px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded">
          Cancel
        </button>
        <button onclick="submitCall()" class="px-4 py-2 text-sm font-medium text-white bg-gray-900 hover:bg-gray-800 rounded">
          Log Call
        </button>
      </div>
    </div>
  </div>
  </div>

  <!-- Top Bar (minimal) -->
  <div class="h-11 bg-white border-b border-gray-200 flex items-center justify-between px-4">
    <div class="flex items-center gap-3">
      <a href="patient-consent-workflow.html" class="p-1 hover:bg-gray-100 rounded">
        <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      </a>
      <span class="w-2 h-2 bg-yellow-400 rounded-full"></span>
      <span class="font-medium text-sm">Pending</span>
      <span class="text-gray-400 text-xs">#12</span>
    </div>
    <button class="text-sm text-gray-500 hover:text-gray-700 flex items-center gap-1">
      Next
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
    </button>
  </div>

  <div class="flex h-[calc(100vh-44px)]">

    <!-- Main Content Panel -->
    <div class="flex-1 flex flex-col border-r border-gray-200 bg-white">

      <!-- Scrollable Content -->
      <div class="flex-1 overflow-y-auto p-3 space-y-3">

        <!-- Unassigned Banner -->
        <div id="unassignedBanner" class="bg-amber-50 border border-amber-200 rounded-lg px-4 py-3 flex items-center justify-between">
          <div class="flex items-center gap-2">
            <div class="w-6 h-6 bg-amber-100 rounded-full flex items-center justify-center">
              <svg class="w-4 h-4 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
              </svg>
            </div>
            <div>
              <span class="text-sm font-medium text-amber-800">This ticket is unassigned</span>
              <span class="text-xs text-amber-600 ml-2">Claim it to start working</span>
            </div>
          </div>
          <button onclick="assignToMe()" class="px-4 py-1.5 bg-amber-600 text-white text-xs font-medium rounded hover:bg-amber-700">
            Assign to Me
          </button>
        </div>

        <!-- Assigned Banner (hidden by default) -->
        <div id="assignedBanner" class="hidden bg-green-50 border border-green-200 rounded-lg px-4 py-3 flex items-center justify-between">
          <div class="flex items-center gap-2">
            <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center">
              <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
            </div>
            <div>
              <span class="text-sm font-medium text-green-800">Assigned to you</span>
              <span class="text-xs text-green-600 ml-2">Nishi Shah</span>
            </div>
          </div>
          <button onclick="unassign()" class="px-3 py-1 text-xs font-medium text-gray-600 hover:bg-green-100 rounded">
            Unassign
          </button>
        </div>

        <!-- Ticket Info (Universal) -->
        <div class="border border-gray-200 rounded">
          <div class="px-3 py-1.5 bg-gray-50 border-b border-gray-200">
            <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Ticket Info</h4>
          </div>
          <div class="p-3 space-y-2 text-xs">
            <div class="flex items-center gap-2">
              <span class="text-gray-500 w-20">Type</span>
              <span class="px-1.5 py-0.5 bg-blue-100 text-blue-700 text-[10px] font-medium rounded">Consent Attempt</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-gray-500 w-20">Status</span>
              <span class="px-1.5 py-0.5 bg-yellow-100 text-yellow-700 text-[10px] font-medium rounded">Pending</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-gray-500 w-20">Priority</span>
              <span class="px-1.5 py-0.5 bg-gray-100 text-gray-700 text-[10px] font-medium rounded">Medium</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-gray-500 w-20">Assignee</span>
              <span id="assigneeValue" class="px-1.5 py-0.5 bg-amber-100 text-amber-700 text-[10px] font-medium rounded">Unassigned</span>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-gray-500 w-20">Created</span>
              <span class="text-gray-900">Feb 17, 2026</span>
            </div>
          </div>
        </div>

        <!-- Consent Attempt Details (Type-Specific) -->
        <div class="border border-gray-200 rounded">
          <div class="px-3 py-1.5 bg-gray-50 border-b border-gray-200">
            <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Consent Details</h4>
          </div>
          <div class="p-3">
            <div class="flex items-start justify-between gap-4">
              <div class="space-y-2 text-xs">
                <div class="flex items-center gap-2">
                  <span class="text-gray-500 w-24">Attempt</span>
                  <span class="text-gray-900 font-medium">2 of 3</span>
                </div>
                <div class="flex items-center gap-2">
                  <span class="text-gray-500 w-24">Prior Attempt</span>
                  <a href="#" class="text-blue-600 hover:underline">Attempt #1 (Failed)</a>
                </div>
                <div class="flex items-center gap-2">
                  <span class="text-gray-500 w-24">Consent Type</span>
                  <span class="text-gray-900">RPM + APCM</span>
                </div>
              </div>
              <div class="relative flex items-center gap-2">
                <label class="text-[10px] text-gray-500">Resolution</label>
                <div class="flex">
                  <button id="resolveBtn" disabled class="inline-flex items-center gap-1.5 px-4 py-2 bg-gray-300 text-gray-500 text-xs font-medium rounded-l cursor-not-allowed" title="Complete required fields to mark as Consented">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    Consented
                  </button>
                  <button id="resolveDropdownBtn" onclick="toggleResolveDropdown()" class="px-2 py-2 bg-gray-700 text-white text-xs font-medium rounded-r border-l border-gray-600 hover:bg-gray-800">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                  </button>
                </div>
                <div id="resolveDropdown" class="hidden absolute right-0 mt-1 w-56 bg-white border border-gray-200 rounded shadow-lg z-10">
                  <button onclick="showCallbackPicker()" class="w-full px-3 py-2 text-left text-xs hover:bg-gray-50 flex items-center gap-2">
                    <span class="w-2 h-2 bg-blue-500 rounded-full"></span>
                    Call Again Later
                  </button>
                  <div id="callbackPicker" class="hidden px-3 py-2 border-t border-gray-100 bg-gray-50">
                    <label class="text-[10px] text-gray-500 block mb-1">Schedule callback</label>
                    <div class="flex gap-1.5">
                      <input type="date" id="callbackDate" class="flex-1 px-2 py-1 text-[11px] border border-gray-200 rounded">
                      <input type="time" id="callbackTime" class="w-20 px-2 py-1 text-[11px] border border-gray-200 rounded">
                    </div>
                    <button onclick="resolveAs('callback')" class="mt-2 w-full px-2 py-1 bg-blue-600 text-white text-[11px] font-medium rounded hover:bg-blue-700">
                      Schedule
                    </button>
                  </div>
                  <button onclick="resolveAs('not_reached')" class="w-full px-3 py-2 text-left text-xs hover:bg-gray-50 flex items-center gap-2">
                    <span class="w-2 h-2 bg-red-500 rounded-full"></span>
                    Not Reached
                  </button>
                  <button onclick="resolveAs('wrong_number')" class="w-full px-3 py-2 text-left text-xs hover:bg-gray-50 flex items-center gap-2">
                    <span class="w-2 h-2 bg-yellow-500 rounded-full"></span>
                    Wrong Number
                  </button>
                  <button onclick="resolveAs('declined')" class="w-full px-3 py-2 text-left text-xs hover:bg-gray-50 flex items-center gap-2">
                    <span class="w-2 h-2 bg-gray-500 rounded-full"></span>
                    Patient Declined
                  </button>
                  <div class="border-t border-gray-100"></div>
                  <button onclick="resolveAs('escalate')" class="w-full px-3 py-2 text-left text-xs hover:bg-gray-50 flex items-center gap-2">
                    <span class="w-2 h-2 bg-orange-500 rounded-full"></span>
                    Escalate
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Consent Workflow -->
        <div class="flex items-center gap-2 pt-2">
          <div class="h-px flex-1 bg-gray-200"></div>
          <span class="text-[10px] font-semibold text-gray-400 uppercase tracking-wider">Consent Workflow</span>
          <div class="h-px flex-1 bg-gray-200"></div>
        </div>

        <!-- Step 1: Introduce SurveyHealth and Provider -->
        <div class="border border-gray-200 rounded bg-white">
          <div class="px-3 py-1.5 bg-gray-50 border-b border-gray-200">
            <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Step 1: Introduce SurveyHealth and <strong class="text-gray-700">Dashing Medical</strong></h4>
          </div>
          <div class="p-3 space-y-3">
            <!-- Script -->
            <div class="bg-slate-50 border border-slate-200 rounded p-2.5 text-xs text-slate-700 leading-relaxed">
              <div class="text-[10px] font-semibold text-slate-400 uppercase mb-1.5">Script</div>
              <p>"My name is <strong>Sally</strong> and I am calling on behalf of <strong>Dashing Medical</strong>. Is this <strong>Simon Jacques</strong>?"</p>
            </div>
            <!-- Action: Is this the patient? -->
            <div>
              <div class="text-xs text-gray-600 mb-2">Is this <strong>Simon Jacques</strong>?</div>
              <div class="flex gap-1.5">
                <button onclick="selectStep1Patient('yes', this)" class="step1-patient-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">Yes</button>
                <button onclick="selectStep1Patient('no', this)" class="step1-patient-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">No</button>
              </div>
            </div>

            <!-- If No: Is patient available? (hidden by default) -->
            <div id="step1PatientAvailable" class="hidden border-l-2 border-amber-300 pl-3 space-y-2">
              <div class="bg-slate-50 border border-slate-200 rounded p-2.5 text-xs text-slate-700 leading-relaxed">
                <p>"Is <strong>Simon Jacques</strong> available?"</p>
              </div>
              <div class="text-xs text-gray-600">Is patient available?</div>
              <div class="flex gap-1.5">
                <button onclick="selectStep1Available('yes', this)" class="step1-available-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">Yes</button>
                <button onclick="selectStep1Available('no', this)" class="step1-available-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">No</button>
              </div>
              <!-- Inline resolution picker -->
              <div id="step1AvailableResolution" class="hidden mt-2 space-y-2">
                <div class="bg-slate-50 border border-slate-200 rounded p-2.5 text-xs text-slate-700 leading-relaxed">
                  <div class="text-[10px] font-semibold text-slate-400 uppercase mb-1.5">Script</div>
                  <p>"When would be a good time to call them again?"</p>
                  <p class="text-slate-500 italic text-[11px] mt-1">(Gather information) "Thank you, tell <strong>Simon Jacques</strong> that we will reach out again soon."</p>
                </div>
                <div class="p-2 bg-amber-50 border border-amber-200 rounded">
                  <div class="text-[10px] font-semibold text-amber-700 uppercase mb-2">Resolve as:</div>
                  <div class="flex flex-wrap gap-1.5">
                    <button onclick="showInlineCallback('step1AvailableCallback')" class="px-2 py-1 text-[11px] font-medium bg-blue-100 text-blue-700 border border-blue-200 rounded hover:bg-blue-200">Call Again Later</button>
                    <button onclick="resolveAs('wrong_number')" class="px-2 py-1 text-[11px] font-medium bg-yellow-100 text-yellow-700 border border-yellow-200 rounded hover:bg-yellow-200">Wrong Number</button>
                    <button onclick="resolveAs('not_reached')" class="px-2 py-1 text-[11px] font-medium bg-red-100 text-red-700 border border-red-200 rounded hover:bg-red-200">Not Reached</button>
                  </div>
                  <div id="step1AvailableCallback" class="hidden mt-2 p-2 bg-white border border-gray-200 rounded">
                    <label class="text-[10px] text-gray-500 block mb-1">Schedule callback</label>
                    <div class="flex gap-1.5">
                      <input type="date" class="inline-callback-date flex-1 px-2 py-1 text-[11px] border border-gray-200 rounded">
                      <input type="time" class="inline-callback-time w-20 px-2 py-1 text-[11px] border border-gray-200 rounded" value="10:00">
                    </div>
                    <button onclick="resolveAs('callback')" class="mt-2 w-full px-2 py-1 bg-blue-600 text-white text-[11px] font-medium rounded hover:bg-blue-700">Schedule & Resolve</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Available to talk (hidden until patient confirmed) -->
            <div id="step1Talk" class="hidden space-y-2">
              <div class="bg-slate-50 border border-slate-200 rounded p-2.5 text-xs text-slate-700 leading-relaxed">
                <p>"<strong>Dr. Dashing</strong> asked me to call you to discuss ways you can better connect with him/her and stay healthy. Do you have a few minutes to talk?"</p>
              </div>
              <div class="text-xs text-gray-600">Patient available to talk?</div>
              <div class="flex gap-1.5">
                <button onclick="selectStep1Talk('yes', this)" class="step1-talk-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">Yes</button>
                <button onclick="selectStep1Talk('no', this)" class="step1-talk-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">No</button>
              </div>
              <!-- Inline resolution picker -->
              <div id="step1TalkResolution" class="hidden mt-2 space-y-2">
                <div class="bg-slate-50 border border-slate-200 rounded p-2.5 text-xs text-slate-700 leading-relaxed">
                  <div class="text-[10px] font-semibold text-slate-400 uppercase mb-1.5">Script</div>
                  <p>"When would be a good time to call again?"</p>
                  <p class="text-slate-500 italic text-[11px] mt-1">(Gather information) "I will call you at your requested time. Thank you."</p>
                </div>
                <div class="p-2 bg-amber-50 border border-amber-200 rounded">
                  <div class="text-[10px] font-semibold text-amber-700 uppercase mb-2">Resolve as:</div>
                  <div class="flex flex-wrap gap-1.5">
                    <button onclick="showInlineCallback('step1TalkCallback')" class="px-2 py-1 text-[11px] font-medium bg-blue-100 text-blue-700 border border-blue-200 rounded hover:bg-blue-200">Call Again Later</button>
                    <button onclick="resolveAs('declined')" class="px-2 py-1 text-[11px] font-medium bg-gray-100 text-gray-700 border border-gray-200 rounded hover:bg-gray-200">Patient Declined</button>
                  </div>
                  <div id="step1TalkCallback" class="hidden mt-2 p-2 bg-white border border-gray-200 rounded">
                    <label class="text-[10px] text-gray-500 block mb-1">Schedule callback</label>
                    <div class="flex gap-1.5">
                      <input type="date" class="inline-callback-date flex-1 px-2 py-1 text-[11px] border border-gray-200 rounded">
                      <input type="time" class="inline-callback-time w-20 px-2 py-1 text-[11px] border border-gray-200 rounded" value="10:00">
                    </div>
                    <button onclick="resolveAs('callback')" class="mt-2 w-full px-2 py-1 bg-blue-600 text-white text-[11px] font-medium rounded hover:bg-blue-700">Schedule & Resolve</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 2: Call Recording -->
        <div class="border border-gray-200 rounded bg-white">
          <div class="px-3 py-1.5 bg-gray-50 border-b border-gray-200">
            <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Step 2: State Call Recording</h4>
          </div>
          <div class="p-3 space-y-3">
            <!-- Script -->
            <div class="bg-slate-50 border border-slate-200 rounded p-2.5 text-xs text-slate-700 leading-relaxed">
              <div class="text-[10px] font-semibold text-slate-400 uppercase mb-1.5">Script</div>
              <p>"I am going to begin recording this call for quality and training purposes."</p>
              <p class="text-slate-500 italic text-[11px] mt-1">(Turn on scribe AI and recording device)</p>
            </div>
            <!-- Action -->
            <div>
              <div class="text-xs text-gray-600 mb-2">Is this call being recorded?</div>
              <div class="flex gap-1.5">
                <button onclick="selectRecording('yes', this)" class="recording-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">Yes</button>
                <button onclick="selectRecording('no', this)" class="recording-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">No</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 3: Verify Identity -->
        <div class="border border-gray-200 rounded bg-white">
          <div class="px-3 py-1.5 bg-gray-50 border-b border-gray-200">
            <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Step 3: Verify Name and DOB</h4>
          </div>
          <div class="p-3 space-y-3">
            <!-- Script -->
            <div class="bg-slate-50 border border-slate-200 rounded p-2.5 text-xs text-slate-700 leading-relaxed">
              <div class="text-[10px] font-semibold text-slate-400 uppercase mb-1.5">Script</div>
              <p>"Can you state your full name and verify your date of birth for me?"</p>
              <p class="text-slate-500 italic text-[11px] mt-1">If not verified: "It seems that the information you provided does not match our records. Let me touch base with Dr. Dashing and call you back later."</p>
            </div>
            <!-- Action -->
            <div>
              <div class="text-xs text-gray-600 mb-2">Patient identity verified?</div>
              <div class="flex gap-1.5">
                <button onclick="selectVerified('yes', this)" class="verified-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">Yes</button>
                <button onclick="selectVerified('no', this)" class="verified-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">No</button>
              </div>
            </div>
            <!-- Inline resolution picker for No -->
            <div id="step3Resolution" class="hidden p-2 bg-amber-50 border border-amber-200 rounded">
              <div class="text-[10px] font-semibold text-amber-700 uppercase mb-2">Resolve as:</div>
              <div class="flex flex-wrap gap-1.5">
                <button onclick="resolveAs('wrong_number')" class="px-2 py-1 text-[11px] font-medium bg-yellow-100 text-yellow-700 border border-yellow-200 rounded hover:bg-yellow-200">Wrong Number</button>
                <button onclick="showInlineCallback('step3Callback')" class="px-2 py-1 text-[11px] font-medium bg-blue-100 text-blue-700 border border-blue-200 rounded hover:bg-blue-200">Call Again Later</button>
              </div>
              <div id="step3Callback" class="hidden mt-2 p-2 bg-white border border-gray-200 rounded">
                <label class="text-[10px] text-gray-500 block mb-1">Schedule callback</label>
                <div class="flex gap-1.5">
                  <input type="date" class="inline-callback-date flex-1 px-2 py-1 text-[11px] border border-gray-200 rounded">
                  <input type="time" class="inline-callback-time w-20 px-2 py-1 text-[11px] border border-gray-200 rounded" value="10:00">
                </div>
                <button onclick="resolveAs('callback')" class="mt-2 w-full px-2 py-1 bg-blue-600 text-white text-[11px] font-medium rounded hover:bg-blue-700">Schedule & Resolve</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 4: Outreach Letter -->
        <div class="border-2 border-blue-200 bg-blue-50/50 rounded">
          <div class="px-3 py-1.5 bg-blue-100/50 border-b border-blue-200 flex items-center justify-between">
            <h4 class="text-xs font-semibold text-blue-700 uppercase tracking-wide">Step 4: Ask About Letter</h4>
            <span class="text-[10px] text-orange-600 font-medium">Required</span>
          </div>
          <div class="p-3 space-y-3">
            <!-- Script -->
            <div class="bg-slate-50 border border-slate-200 rounded p-2.5 text-xs text-slate-700 leading-relaxed">
              <div class="text-[10px] font-semibold text-slate-400 uppercase mb-1.5">Script</div>
              <p>"Did you receive the letter that was sent to you from <strong>Dashing Medical</strong> a few days ago?"</p>
              <p class="text-slate-500 italic text-[11px] mt-1">If no: "No worries." (Proceed to next step)</p>
              <p class="text-slate-500 italic text-[11px]">If yes: "Great, I am going over the information in the letter at a high level." (Proceed to next step)</p>
            </div>
            <!-- Action -->
            <div>
              <div class="text-xs text-gray-600 mb-2">Did the patient receive the letter?</div>
              <div class="flex gap-1.5">
                <button onclick="selectLetter('yes', this)" class="letter-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">Yes</button>
                <button onclick="selectLetter('no', this)" class="letter-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">No</button>
                <button onclick="selectLetter('not_received', this)" class="letter-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">Didn't receive</button>
              </div>
              <input type="hidden" id="letterStatus" value="">
            </div>
          </div>
        </div>

        <!-- Step 5: Explain Programs -->
        <div class="border border-gray-200 rounded bg-white">
          <div class="px-3 py-1.5 bg-gray-50 border-b border-gray-200">
            <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Step 5: Explain RPM and APCM Programs</h4>
          </div>
          <div class="p-3 space-y-3">
            <!-- Script -->
            <div class="bg-slate-50 border border-slate-200 rounded p-2.5 text-xs text-slate-700 leading-relaxed max-h-48 overflow-y-auto">
              <div class="text-[10px] font-semibold text-slate-400 uppercase mb-1.5">Script</div>
              <p class="mb-2">"There are two programs that <strong>Dr. Dashing</strong> recommended for you.</p>
              <p class="mb-2">The first one is <strong>APCM</strong> or Advanced Primary Care Management. This program allows Dr. Dashing to check in on you in-between office visits. The check-in will occur by text message or a phone call at least once a week, or more often if needed. The check-ins will only last 1-2 minutes and if there are any issues, your doctor will be informed so that he/she can act right away to address those issues.</p>
              <p class="mb-2">The second program is <strong>RPM</strong> or remote patient monitoring. This program allows us to take your vital signs—such as your blood pressure, heart rate, and how fast you are breathing—through your phone without any extra equipment. You will just need to take a selfie video for up to 60 seconds. Also, we may ask a few questions to monitor your wellbeing by checking your voice.</p>
              <p class="mb-2 text-slate-500 italic">(For patients without chronic diseases: "Even if you are healthy, we may use the RPM program after a hospital stay, a visit to an emergency room, or after a procedure to make sure you are recovering okay.")</p>
              <p class="mb-2">These programs are not emergency services. They are used to proactively reach out to you to see if you need help before you get any symptoms or your symptoms get worse. All information gathered is secure and HIPAA compliant. Even if you give permission now, you can opt out of either program at any time by texting or saying STOP during one of your interactions.</p>
              <p class="mb-2 text-slate-500 italic">(For patients without co-pays: "Although your doctor will bill insurance for these programs, you will not have any out-of-pocket costs.")</p>
              <p class="mb-2 text-slate-500 italic">(For patients with co-pays: "The APCM program will have a co-pay of $X per month. The RPM program will have a co-pay of $X per month only when we need to monitor you more closely.")</p>
              <p>Do you have any questions?"</p>
            </div>
            <!-- Actions -->
            <div class="space-y-2 pt-1">
              <label class="flex items-start gap-2 cursor-pointer">
                <input type="checkbox" class="consent-check mt-0.5 w-4 h-4 text-blue-600 rounded" onchange="updateChecklist()">
                <span class="text-xs text-gray-700">Explained APCM program (check-ins between visits, 1-2 min calls/texts weekly).</span>
              </label>
              <label class="flex items-start gap-2 cursor-pointer">
                <input type="checkbox" class="consent-check mt-0.5 w-4 h-4 text-blue-600 rounded" onchange="updateChecklist()">
                <span class="text-xs text-gray-700">Explained RPM program (vital signs via phone selfie video, voice monitoring).</span>
              </label>
              <label class="flex items-start gap-2 cursor-pointer">
                <input type="checkbox" class="consent-check mt-0.5 w-4 h-4 text-blue-600 rounded" onchange="updateChecklist()">
                <span class="text-xs text-gray-700">Clarified these are not emergency services (call 911 for emergencies).</span>
              </label>
              <label class="flex items-start gap-2 cursor-pointer">
                <input type="checkbox" class="consent-check mt-0.5 w-4 h-4 text-blue-600 rounded" onchange="updateChecklist()">
                <span class="text-xs text-gray-700">Explained data is secure and HIPAA compliant.</span>
              </label>
              <label class="flex items-start gap-2 cursor-pointer">
                <input type="checkbox" class="consent-check mt-0.5 w-4 h-4 text-blue-600 rounded" onchange="updateChecklist()">
                <span class="text-xs text-gray-700">Informed patient they can opt out at any time.</span>
              </label>
              <label class="flex items-start gap-2 cursor-pointer">
                <input type="checkbox" class="consent-check mt-0.5 w-4 h-4 text-blue-600 rounded" onchange="updateChecklist()">
                <span class="text-xs text-gray-700">Explained cost/coverage (Medicare Part B, co-pays if applicable).</span>
              </label>
              <label class="flex items-start gap-2 cursor-pointer">
                <input type="checkbox" class="consent-check mt-0.5 w-4 h-4 text-blue-600 rounded" onchange="updateChecklist()">
                <span class="text-xs text-gray-700">Asked if patient has any questions and answered them.</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Step 6: Program Enrollment -->
        <div class="border-2 border-blue-200 bg-blue-50/50 rounded">
          <div class="px-3 py-1.5 bg-blue-100/50 border-b border-blue-200 flex items-center justify-between">
            <h4 class="text-xs font-semibold text-blue-700 uppercase tracking-wide">Step 6: Consent for APCM and RPM</h4>
            <span class="text-[10px] text-orange-600 font-medium">Required</span>
          </div>
          <div class="p-3 space-y-3">
            <!-- Script -->
            <div class="bg-slate-50 border border-slate-200 rounded p-2.5 text-xs text-slate-700 leading-relaxed">
              <div class="text-[10px] font-semibold text-slate-400 uppercase mb-1.5">Script</div>
              <p class="mb-2">"Great! Do we have your permission to enroll you in both the APCM and RPM programs?"</p>
              <p class="text-slate-500 italic text-[11px] mb-1">If yes to both: "That is great. I really think you will see the benefits of this program."</p>
              <p class="text-slate-500 italic text-[11px] mb-1">If no to one/both: "Would you mind sharing with me why you are not comfortable consenting? Is there some information I can relay back to Dr. Dashing?"</p>
              <p class="text-slate-500 italic text-[11px]">(Document reason. Use Q&A document to address hesitation.)</p>
            </div>
            <!-- Action -->
            <div>
              <div class="text-xs text-gray-600 mb-2">Does the patient consent to APCM and RPM program enrollment?</div>
              <div class="flex gap-1.5">
                <button onclick="selectEnrollment('yes', this)" class="enrollment-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">Yes</button>
                <button onclick="selectEnrollment('no', this)" class="enrollment-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">No</button>
              </div>
              <input type="hidden" id="enrollmentSelected" value="">
            </div>
          </div>
        </div>

        <!-- Step 7: Communication Preferences -->
        <div class="border-2 border-blue-200 bg-blue-50/50 rounded">
          <div class="px-3 py-1.5 bg-blue-100/50 border-b border-blue-200 flex items-center justify-between">
            <h4 class="text-xs font-semibold text-blue-700 uppercase tracking-wide">Step 7: Confirm Phone and Communication</h4>
            <span class="text-[10px] text-orange-600 font-medium">Required</span>
          </div>
          <div class="p-3 space-y-3">
            <!-- Script -->
            <div class="bg-slate-50 border border-slate-200 rounded p-2.5 text-xs text-slate-700 leading-relaxed">
              <div class="text-[10px] font-semibold text-slate-400 uppercase mb-1.5">Script</div>
              <p class="mb-2">"Is this the cell phone number we can contact you with?"</p>
              <p class="text-slate-500 italic text-[11px] mb-2">If no: "Can you provide the cell phone number you would like to use?"</p>
              <p class="mb-2">"Do you prefer to check in by text or call?"</p>
              <p class="mb-2">"Do you have a caretaker or someone that helps you out?"</p>
              <p class="text-slate-500 italic text-[11px]">If yes: "Can you provide me with your caretaker's cell phone number?"</p>
            </div>
            <!-- Actions -->
            <div>
              <div class="text-xs text-gray-600 mb-2">How does the patient prefer to check in?</div>
              <div class="flex gap-1.5">
                <button onclick="selectFollowup('voice', this)" class="followup-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">Call</button>
                <button onclick="selectFollowup('sms', this)" class="followup-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">Text</button>
              </div>
              <input type="hidden" id="followupPreference" value="">
            </div>
            <div class="border-t border-blue-200 pt-3">
              <div class="text-xs text-gray-600 mb-2">Does the patient have a caretaker?</div>
              <div class="space-y-2">
                <label class="flex items-center gap-2 p-2 bg-white border border-gray-200 rounded cursor-pointer hover:bg-gray-50">
                  <input type="radio" name="hasCaretaker" value="no" checked class="w-3.5 h-3.5 text-blue-600" onchange="toggleCaretakerFields()">
                  <span class="text-xs font-medium text-gray-900">No</span>
                </label>
                <label class="flex items-center gap-2 p-2 bg-white border border-gray-200 rounded cursor-pointer hover:bg-gray-50">
                  <input type="radio" name="hasCaretaker" value="yes" class="w-3.5 h-3.5 text-blue-600" onchange="toggleCaretakerFields()">
                  <span class="text-xs font-medium text-gray-900">Yes</span>
                </label>

                <!-- Caretaker Fields (hidden by default) -->
                <div id="caretakerFields" class="hidden pl-6 space-y-2 pt-1">
                  <div>
                    <label class="text-[10px] text-gray-500 block mb-1">Caretaker Name</label>
                    <input type="text" placeholder="Enter name" class="w-full px-2 py-1.5 text-xs border border-gray-200 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                  </div>
                  <div>
                    <label class="text-[10px] text-gray-500 block mb-1">Relationship</label>
                    <div class="flex gap-1.5">
                      <button onclick="selectRelationship('family', this)" class="relationship-btn px-2 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">Family</button>
                      <button onclick="selectRelationship('friend', this)" class="relationship-btn px-2 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">Friend</button>
                      <button onclick="selectRelationship('other', this)" class="relationship-btn px-2 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">Other</button>
                    </div>
                  </div>
                  <div>
                    <label class="text-[10px] text-gray-500 block mb-1">Phone Number</label>
                    <input type="tel" placeholder="(555) 555-5555" class="w-full px-2 py-1.5 text-xs border border-gray-200 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                  </div>
                  <div>
                    <label class="text-[10px] text-gray-500 block mb-1">Phone Type</label>
                    <div class="flex gap-2">
                      <label class="flex items-center gap-1.5 cursor-pointer">
                        <input type="radio" name="caretakerPhoneType" value="cell" checked class="w-3 h-3 text-blue-600">
                        <span class="text-[11px] text-gray-700">Cell</span>
                      </label>
                      <label class="flex items-center gap-1.5 cursor-pointer">
                        <input type="radio" name="caretakerPhoneType" value="landline" class="w-3 h-3 text-blue-600">
                        <span class="text-[11px] text-gray-700">Landline</span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Step 8: Baseline Vitals -->
        <div class="border-2 border-blue-200 bg-blue-50/50 rounded">
          <div class="px-3 py-1.5 bg-blue-100/50 border-b border-blue-200 flex items-center justify-between">
            <h4 class="text-xs font-semibold text-blue-700 uppercase tracking-wide">Step 8: Get Baseline Vital Signs</h4>
            <span class="text-[10px] text-orange-600 font-medium">Required</span>
          </div>
          <div class="p-3 space-y-3">
            <!-- Script -->
            <div class="bg-slate-50 border border-slate-200 rounded p-2.5 text-xs text-slate-700 leading-relaxed">
              <div class="text-[10px] font-semibold text-slate-400 uppercase mb-1.5">Script</div>
              <p class="mb-2">"Would it be okay for me to check your vital signs by phone now?"</p>
              <p class="text-slate-500 italic text-[11px] mb-2">If no: "This will allow you to better understand how we will take your vital signs without any equipment except for your phone."</p>
              <p>"I will send you a text to your cell phone. Follow the instructions by clicking on the hyperlink in the text and then pressing the start button. We will then be able to take your vitals. I will stay on while you take your vitals. You will need to remain silent for 60 seconds while your vitals are being taken."</p>
              <p class="text-slate-500 italic text-[11px] mt-1">(Help patient with taking their vitals if there are any issues)</p>
            </div>
            <!-- Action -->
            <div id="vitalsNotSent" class="text-xs text-gray-600 mb-2">Send vitals link to capture baseline readings during the call.</div>

            <!-- Initial State: Not Sent -->
            <div id="vitalsSendSection">
              <button onclick="sendVitalsLink()" class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 text-white text-xs font-medium rounded hover:bg-blue-700">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                </svg>
                Send Vitals Link
              </button>
            </div>

            <!-- Sent State: Waiting for Results -->
            <div id="vitalsWaitingSection" class="hidden">
              <div class="flex items-center gap-2 p-2 bg-yellow-50 border border-yellow-200 rounded mb-2">
                <svg class="w-4 h-4 text-yellow-600 animate-spin" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span class="text-xs text-yellow-800">Waiting for patient to complete scan...</span>
              </div>
              <div class="flex gap-2">
                <button onclick="refreshVitals()" class="inline-flex items-center gap-1 px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                  </svg>
                  Refresh
                </button>
                <button onclick="resendVitals()" class="inline-flex items-center gap-1 px-2.5 py-1 text-[11px] font-medium text-red-600 border border-red-200 rounded hover:bg-red-50">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                  </svg>
                  Resend Link
                </button>
              </div>
            </div>

            <!-- Completed State: Results Received -->
            <div id="vitalsCompletedSection" class="hidden">
              <div class="flex items-center gap-2 p-2 bg-green-50 border border-green-200 rounded mb-2">
                <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                <span class="text-xs text-green-800">Vitals captured successfully</span>
              </div>
              <div class="grid grid-cols-3 gap-2 text-xs">
                <div class="p-2 bg-white border border-gray-200 rounded text-center">
                  <div class="text-gray-500 text-[10px]">HR</div>
                  <div class="font-semibold text-gray-900">82</div>
                </div>
                <div class="p-2 bg-white border border-gray-200 rounded text-center">
                  <div class="text-gray-500 text-[10px]">BP</div>
                  <div class="font-semibold text-gray-900">128/84</div>
                </div>
                <div class="p-2 bg-white border border-gray-200 rounded text-center">
                  <div class="text-gray-500 text-[10px]">RR</div>
                  <div class="font-semibold text-gray-900">16</div>
                </div>
              </div>
            </div>

            <input type="hidden" id="vitalsStatus" value="">
          </div>
        </div>

        <!-- Step 9: Close Call -->
        <div class="border border-gray-200 rounded bg-white">
          <div class="px-3 py-1.5 bg-gray-50 border-b border-gray-200">
            <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Step 9: Close and Provide Contact Info</h4>
          </div>
          <div class="p-3 space-y-3">
            <!-- Script -->
            <div class="bg-slate-50 border border-slate-200 rounded p-2.5 text-xs text-slate-700 leading-relaxed">
              <div class="text-[10px] font-semibold text-slate-400 uppercase mb-1.5">Script</div>
              <p class="mb-2">"You will receive a text message/phone call starting next week. Sometimes there may be a follow-up call from a nurse depending on your responses. Your doctor will also be informed about your responses. If we feel that you need to see <strong>Dr. Dashing</strong> sooner, we will assist in getting you an appointment. Do you have any questions?"</p>
              <p class="mb-2">"Can you save the phone number I am calling from and the phone number of your text message so that our calls and messages do not get stuck in spam?"</p>
              <p>"Great. If you do have any questions, you can call <strong>Dashing Medical</strong> at <strong>(215) 735-3345</strong>. Thanks."</p>
            </div>
            <!-- Action -->
            <div>
              <div class="text-xs text-gray-600 mb-2">Patient asked to save contact number?</div>
              <div class="flex gap-1.5">
                <button onclick="selectCloseCall('yes', this)" class="close-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">Yes</button>
                <button onclick="selectCloseCall('no', this)" class="close-btn px-2.5 py-1 text-[11px] font-medium border border-gray-200 rounded hover:bg-gray-50 bg-white text-gray-700">No</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Section: Additional Information -->
        <div class="flex items-center gap-2 pt-2">
          <div class="h-px flex-1 bg-gray-200"></div>
          <span class="text-[10px] font-semibold text-gray-400 uppercase tracking-wider">Additional Information</span>
          <div class="h-px flex-1 bg-gray-200"></div>
        </div>

        <!-- Patient Concerns -->
        <div class="border-2 border-blue-200 bg-blue-50/50 rounded">
          <div class="px-3 py-1.5 bg-blue-100/50 border-b border-blue-200">
            <h4 class="text-xs font-semibold text-blue-700 uppercase tracking-wide">Patient Concerns</h4>
          </div>
          <div class="p-3">
            <div class="text-xs text-gray-600 mb-2">Note any concerns or questions raised by the patient:</div>
            <textarea
              id="patientConcerns"
              class="w-full h-16 px-2 py-1.5 text-xs border border-gray-200 rounded resize-none focus:outline-none focus:ring-1 focus:ring-blue-500 bg-white"
              placeholder="e.g., worried about side effects, has questions about the program..."
            ></textarea>
          </div>
        </div>

        <!-- Internal Notes -->
        <div class="border border-gray-200 rounded">
          <div class="px-3 py-1.5 bg-gray-50 border-b border-gray-200">
            <h4 class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Internal Notes</h4>
          </div>
          <div class="p-3">
            <textarea
              class="w-full h-16 px-2 py-1.5 text-xs border border-gray-200 rounded resize-none focus:outline-none focus:ring-1 focus:ring-blue-500"
              placeholder="Add a note about this interaction..."
            ></textarea>
            <div class="flex justify-end mt-2">
              <button class="px-3 py-1 bg-gray-900 text-white text-xs font-medium rounded hover:bg-gray-800">
                Submit Note
              </button>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Right Sidebar -->
    <div class="w-80 bg-gray-50 overflow-y-auto text-xs">

      <!-- Patient Header -->
      <div class="p-3 bg-white border-b border-gray-200">
        <div class="flex items-center gap-2 mb-2">
          <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-gray-600 font-semibold text-sm">
            SJ
          </div>
          <div>
            <div class="font-semibold text-gray-900 text-sm">Simon Jacques</div>
          </div>
        </div>

        <!-- Phone Numbers (compact) -->
        <div class="text-xs space-y-1 mb-3">
          <div class="flex items-center gap-1.5">
            <svg class="w-3 h-3 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
            </svg>
            <span class="text-gray-900">(212) 384-2733</span>
            <span class="px-1 py-0.5 bg-blue-100 text-blue-700 text-[8px] font-medium rounded">PRIMARY</span>
            <span class="text-[9px] text-gray-400">Cell</span>
            <button onclick="openPhoneModal('edit', '(212) 384-2733', 'cell', true)" class="ml-auto text-[9px] text-blue-600 hover:underline">Edit</button>
          </div>
          <div class="flex items-center gap-1.5 text-gray-500">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
              <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
            </svg>
            <span>(212) 555-1234</span>
            <span class="text-[9px] text-gray-400">Landline</span>
            <button onclick="openPhoneModal('edit', '(212) 555-1234', 'landline', false)" class="ml-auto text-[9px] text-blue-600 hover:underline">Edit</button>
          </div>
          <button onclick="openPhoneModal('add')" class="text-[9px] text-blue-600 hover:underline">+ Add number</button>
        </div>

        <!-- Call Actions -->
        <div class="flex gap-2">
          <button class="flex-1 inline-flex items-center justify-center gap-1.5 px-3 py-2 bg-green-600 text-white text-xs font-medium rounded hover:bg-green-700">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
            </svg>
            Call
          </button>
          <button onclick="openModal()" class="flex-1 inline-flex items-center justify-center gap-1.5 px-3 py-2 bg-white border border-gray-200 text-xs font-medium rounded hover:bg-gray-50">
            <svg class="w-3.5 h-3.5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
            </svg>
            Log Call
          </button>
        </div>
      </div>

      <div class="p-3 space-y-4">

        <!-- Demographics -->
        <div>
          <h5 class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">Demographics</h5>
          <div class="space-y-1">
            <div class="flex justify-between">
              <span class="text-gray-500">DOB</span>
              <span class="text-gray-900">04/22/1962 (63)</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-500">Gender</span>
              <span class="text-gray-900">Male</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-500">State</span>
              <span class="text-gray-900">PA</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-500">Insurance</span>
              <span class="text-gray-900">United PPO Plus</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-500">Diagnoses</span>
              <span class="text-gray-900 text-right">Hypertension, Diabetes</span>
            </div>
          </div>
        </div>

        <!-- Provider -->
        <div>
          <h5 class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">Provider</h5>
          <div class="space-y-1">
            <div class="flex justify-between">
              <span class="text-gray-500">Name</span>
              <span class="text-gray-900">Dr. Mark Dashing</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-500">Practice</span>
              <span class="text-gray-900">Dashing Medical</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-500">Location</span>
              <span class="text-gray-900">Lexington, PA</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-500">Phone</span>
              <span class="text-gray-900">(215) 735-3345</span>
            </div>
          </div>
        </div>

        <!-- Activity Log -->
        <div>
          <h5 class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2">Activity Log</h5>
          <div id="activityLog" class="space-y-2">

            <!-- Logged Call (Reached) -->
            <div class="bg-white border border-green-200 rounded p-2">
              <div class="flex items-center justify-between mb-1.5">
                <div class="flex items-center gap-1.5">
                  <div class="w-5 h-5 bg-green-100 rounded-full flex items-center justify-center">
                    <svg class="w-2.5 h-2.5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                    </svg>
                  </div>
                  <span class="font-semibold text-gray-900">Call</span>
                  <span class="px-1 py-0.5 bg-green-100 text-green-700 text-[9px] font-medium rounded">Reached</span>
                </div>
                <span class="text-gray-400 text-[10px]">Nov 8 4:12 PM</span>
              </div>
              <div class="space-y-0.5 text-[11px] ml-6">
                <div class="flex justify-between">
                  <span class="text-gray-500">Time</span>
                  <span class="text-gray-900">4:02 PM – 4:12 PM (10 min)</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-500">Notes</span>
                  <span class="text-gray-900">Patient at work, call back after 6pm</span>
                </div>
                <a href="#" class="inline-flex items-center gap-1 text-blue-600 hover:underline mt-1">
                  View in OpenPhone →
                </a>
              </div>
            </div>

            <!-- Vitals Scan -->
            <div class="bg-white border border-green-200 rounded p-2">
              <div class="flex items-center justify-between mb-1.5">
                <div class="flex items-center gap-1.5">
                  <div class="w-5 h-5 bg-green-100 rounded-full flex items-center justify-center">
                    <svg class="w-2.5 h-2.5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                  </div>
                  <span class="font-semibold text-gray-900">Vitals Scan</span>
                  <span class="px-1 py-0.5 bg-green-100 text-green-700 text-[9px] font-medium rounded">Completed</span>
                </div>
                <span class="text-gray-400 text-[10px]">Nov 8 2:40 PM</span>
              </div>
              <div class="ml-6 text-[11px]">
                <div class="flex gap-3 text-gray-700">
                  <span><span class="text-gray-500">HR:</span> 82</span>
                  <span><span class="text-gray-500">BP:</span> 114/83</span>
                </div>
                <a href="#" class="inline-flex items-center gap-1 text-blue-600 hover:underline mt-1">
                  View full scan →
                </a>
              </div>
            </div>

            
            <!-- Logged Call (No Answer) -->
            <div class="bg-white border border-orange-200 rounded p-2">
              <div class="flex items-center justify-between mb-1.5">
                <div class="flex items-center gap-1.5">
                  <div class="w-5 h-5 bg-orange-100 rounded-full flex items-center justify-center">
                    <svg class="w-2.5 h-2.5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                    </svg>
                  </div>
                  <span class="font-semibold text-gray-900">Call</span>
                  <span class="px-1 py-0.5 bg-orange-100 text-orange-700 text-[9px] font-medium rounded">No Answer</span>
                </div>
                <span class="text-gray-400 text-[10px]">Nov 8 3:15 PM</span>
              </div>
              <div class="space-y-0.5 text-[11px] ml-6">
                <div class="flex justify-between">
                  <span class="text-gray-500">Agent</span>
                  <span class="text-gray-900">Nishi Shah</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-gray-500">Duration</span>
                  <span class="text-gray-900">0:42</span>
                </div>
                <a href="#" class="inline-flex items-center gap-1 text-blue-600 hover:underline mt-1">
                  View in OpenPhone →
                </a>
              </div>
            </div>

            <!-- SMS Sent -->
            <div class="bg-white border border-gray-200 rounded p-2">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-1.5">
                  <div class="w-5 h-5 bg-blue-100 rounded-full flex items-center justify-center">
                    <svg class="w-2.5 h-2.5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                    </svg>
                  </div>
                  <span class="font-medium text-gray-900">SMS Sent</span>
                </div>
                <span class="text-gray-400 text-[10px]">Nov 7 10:00 AM</span>
              </div>
              <div class="ml-6 mt-0.5">
                <p class="text-gray-500 text-[10px]">Auto · Initial consent request</p>
                <a href="#" class="inline-flex items-center gap-1 text-blue-600 hover:underline text-[10px]">
                  View message →
                </a>
              </div>
            </div>

            <!-- SMS Response -->
            <div class="bg-white border border-gray-200 rounded p-2">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-1.5">
                  <div class="w-5 h-5 bg-purple-100 rounded-full flex items-center justify-center">
                    <svg class="w-2.5 h-2.5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                    </svg>
                  </div>
                  <span class="font-medium text-gray-900">SMS Response</span>
                </div>
                <span class="text-gray-400 text-[10px]">Nov 7 10:15 AM</span>
              </div>
              <div class="ml-6 mt-0.5">
                <p class="text-gray-500 text-[10px]">Patient replied "Yes"</p>
                <a href="#" class="inline-flex items-center gap-1 text-blue-600 hover:underline text-[10px]">
                  View thread →
                </a>
              </div>
            </div>

            <!-- Consent Attempt #1 (Previous Ticket) -->
            <div class="bg-white border border-red-200 rounded p-2">
              <div class="flex items-center justify-between mb-1.5">
                <div class="flex items-center gap-1.5">
                  <div class="w-5 h-5 bg-red-100 rounded-full flex items-center justify-center">
                    <svg class="w-2.5 h-2.5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m2 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                  </div>
                  <span class="font-semibold text-gray-900">Consent Attempt #1</span>
                  <span class="px-1 py-0.5 bg-red-100 text-red-700 text-[9px] font-medium rounded">Failed</span>
                </div>
                <span class="text-gray-400 text-[10px]">Nov 7 4:30 PM</span>
              </div>
              <div class="space-y-0.5 text-[11px] ml-6">
                <div class="flex justify-between">
                  <span class="text-gray-500">Agent</span>
                  <span class="text-gray-900">Nishi Shah</span>
                </div>
                <a href="#" class="inline-flex items-center gap-1 text-blue-600 hover:underline mt-1">
                  View ticket →
                </a>
              </div>
            </div>

            <!-- Ticket Created -->
            <div class="bg-white border border-gray-200 rounded p-2">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-1.5">
                  <div class="w-5 h-5 bg-gray-100 rounded-full flex items-center justify-center">
                    <svg class="w-2.5 h-2.5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                  </div>
                  <span class="font-medium text-gray-900">Ticket Created</span>
                </div>
                <span class="text-gray-400 text-[10px]">Nov 6 9:00 AM</span>
              </div>
              <p class="text-gray-500 text-[10px] ml-6 mt-0.5">Patient added to consent queue</p>
            </div>

          </div>
        </div>

      </div>
    </div>

  </div>

  <script>
    // No longer need campaignsConfirmed - using enrollmentChoice instead

    // Assignment Functions
    function assignToMe() {
      document.getElementById('unassignedBanner').classList.add('hidden');
      document.getElementById('assignedBanner').classList.remove('hidden');
      // Update the Assignee field in Ticket Info
      const assigneeSpan = document.getElementById('assigneeValue');
      assigneeSpan.textContent = 'Nishi Shah';
      assigneeSpan.className = 'px-1.5 py-0.5 bg-green-100 text-green-700 text-[10px] font-medium rounded';
    }

    function unassign() {
      document.getElementById('assignedBanner').classList.add('hidden');
      document.getElementById('unassignedBanner').classList.remove('hidden');
      // Update the Assignee field back to Unassigned
      const assigneeSpan = document.getElementById('assigneeValue');
      assigneeSpan.textContent = 'Unassigned';
      assigneeSpan.className = 'px-1.5 py-0.5 bg-amber-100 text-amber-700 text-[10px] font-medium rounded';
    }

    function openModal() {
      document.getElementById('modalBackdrop').classList.remove('hidden');
      document.getElementById('logCallModal').classList.remove('hidden');
      document.getElementById('logCallModal').classList.add('flex');
      document.getElementById('timeSection').classList.remove('hidden');
      document.querySelector('input[name="call_status"][value="reached"]').checked = true;
      setDefaultTimes();
    }

    function closeModal() {
      document.getElementById('logCallModal').classList.add('hidden');
      document.getElementById('logCallModal').classList.remove('flex');
      document.getElementById('modalBackdrop').classList.add('hidden');
    }

    function closeAllModals() {
      closeModal();
      closePhoneModal();
    }

    // Phone Modal Functions
    function openPhoneModal(mode, number = '', type = 'cell', isPrimary = false) {
      document.getElementById('modalBackdrop').classList.remove('hidden');
      document.getElementById('phoneModal').classList.remove('hidden');
      document.getElementById('phoneModal').classList.add('flex');

      document.getElementById('phoneModalTitle').textContent = mode === 'add' ? 'Add Phone Number' : 'Edit Phone Number';
      document.getElementById('phoneInput').value = number;
      document.querySelector(`input[name="phoneType"][value="${type}"]`).checked = true;
      document.getElementById('phonePrimary').checked = isPrimary;
    }

    function closePhoneModal() {
      document.getElementById('phoneModal').classList.add('hidden');
      document.getElementById('phoneModal').classList.remove('flex');
      document.getElementById('modalBackdrop').classList.add('hidden');
    }

    function savePhone() {
      const number = document.getElementById('phoneInput').value;
      const type = document.querySelector('input[name="phoneType"]:checked').value;
      const isPrimary = document.getElementById('phonePrimary').checked;
      // In real app, would save to backend
      alert(`Saved: ${number} (${type})${isPrimary ? ' - Primary' : ''}`);
      closePhoneModal();
    }

    function setDefaultTimes() {
      const now = new Date();
      const start = new Date(now.getTime() - 10 * 60000);
      document.getElementById('endTime').value = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
      document.getElementById('startTime').value = `${String(start.getHours()).padStart(2, '0')}:${String(start.getMinutes()).padStart(2, '0')}`;
    }

    function toggleTimeSection() {
      const status = document.querySelector('input[name="call_status"]:checked')?.value;
      const timeSection = document.getElementById('timeSection');
      if (status === 'reached' || status === 'wrong_number') {
        timeSection.classList.remove('hidden');
      } else {
        timeSection.classList.add('hidden');
      }
    }

    function submitCall() {
      const callStatus = document.querySelector('input[name="call_status"]:checked')?.value || 'reached';
      const startTimeVal = document.getElementById('startTime').value;
      const endTimeVal = document.getElementById('endTime').value;
      const notes = document.getElementById('callNotes').value;

      // Format status labels
      const statusLabels = {
        'reached': 'Reached',
        'no_answer': 'No Answer',
        'voicemail': 'Voicemail',
        'wrong_number': 'Wrong Number'
      };

      // Parse times (only for reached/wrong_number)
      let timeDisplay = '';
      if (startTimeVal && endTimeVal && (callStatus === 'reached' || callStatus === 'wrong_number')) {
        const [startH, startM] = startTimeVal.split(':').map(Number);
        const [endH, endM] = endTimeVal.split(':').map(Number);
        const startDate = new Date();
        startDate.setHours(startH, startM, 0, 0);
        const endDate = new Date();
        endDate.setHours(endH, endM, 0, 0);
        const durationMin = Math.round((endDate - startDate) / 60000);
        const formatTime = (date) => {
          const h = date.getHours() % 12 || 12;
          const m = String(date.getMinutes()).padStart(2, '0');
          const ampm = date.getHours() >= 12 ? 'PM' : 'AM';
          return `${h}:${m} ${ampm}`;
        };
        timeDisplay = `${formatTime(startDate)} – ${formatTime(endDate)} (${durationMin} min)`;
      }

      const dateStr = new Date().toLocaleString('en-US', { month: 'short', day: 'numeric' });

      // Determine border and icon color based on outcome
      let borderColor, bgColor, iconColor;
      if (callStatus === 'reached') {
        borderColor = 'green-200';
        bgColor = 'green-100';
        iconColor = 'green-600';
      } else {
        borderColor = 'orange-200';
        bgColor = 'orange-100';
        iconColor = 'orange-600';
      }

      const newEntry = document.createElement('div');
      newEntry.className = `bg-white border border-${borderColor} rounded p-2`;
      newEntry.innerHTML = `
        <div class="flex items-center justify-between mb-1.5">
          <div class="flex items-center gap-1.5">
            <div class="w-5 h-5 bg-${bgColor} rounded-full flex items-center justify-center">
              <svg class="w-2.5 h-2.5 text-${iconColor}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
              </svg>
            </div>
            <span class="font-semibold text-gray-900">Call</span>
            <span class="px-1 py-0.5 bg-${bgColor} text-${iconColor} text-[9px] font-medium rounded">${statusLabels[callStatus]}</span>
          </div>
          <span class="text-gray-400 text-[10px]">${dateStr}</span>
        </div>
        <div class="space-y-0.5 text-[11px] ml-6">
          ${timeDisplay ? `<div class="flex justify-between">
            <span class="text-gray-500">Time</span>
            <span class="text-gray-900">${timeDisplay}</span>
          </div>` : ''}
          ${notes ? `<div class="flex justify-between">
            <span class="text-gray-500">Notes</span>
            <span class="text-gray-900">${notes}</span>
          </div>` : ''}
        </div>
      `;

      const activityLog = document.getElementById('activityLog');
      activityLog.insertBefore(newEntry, activityLog.firstChild);

      // Clear form
      document.getElementById('callNotes').value = '';

      closeModal();
    }

    // Enter key to submit
    document.getElementById('logCallModal')?.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        submitCall();
      }
    });

    function selectEnrollment(value, btn) {
      document.getElementById('enrollmentSelected').value = value;
      document.querySelectorAll('.enrollment-btn').forEach(b => {
        b.classList.remove('bg-blue-50', 'border-blue-300', 'text-blue-700');
        b.classList.add('bg-white', 'border-gray-200', 'text-gray-700');
      });
      btn.classList.remove('bg-white', 'border-gray-200', 'text-gray-700');
      btn.classList.add('bg-blue-50', 'border-blue-300', 'text-blue-700');
      checkResolveRequirements();
    }

    function updateChecklist() {
      checkResolveRequirements();
    }

    function selectRecording(value, btn) {
      document.querySelectorAll('.recording-btn').forEach(b => {
        b.classList.remove('bg-blue-50', 'border-blue-300', 'text-blue-700');
        b.classList.add('bg-white', 'border-gray-200', 'text-gray-700');
      });
      btn.classList.remove('bg-white', 'border-gray-200', 'text-gray-700');
      btn.classList.add('bg-blue-50', 'border-blue-300', 'text-blue-700');
    }

    // Step 1 branching logic
    function selectStep1Patient(value, btn) {
      document.querySelectorAll('.step1-patient-btn').forEach(b => {
        b.classList.remove('bg-blue-50', 'border-blue-300', 'text-blue-700');
        b.classList.add('bg-white', 'border-gray-200', 'text-gray-700');
      });
      btn.classList.remove('bg-white', 'border-gray-200', 'text-gray-700');
      btn.classList.add('bg-blue-50', 'border-blue-300', 'text-blue-700');

      if (value === 'yes') {
        document.getElementById('step1PatientAvailable').classList.add('hidden');
        document.getElementById('step1Talk').classList.remove('hidden');
      } else {
        document.getElementById('step1PatientAvailable').classList.remove('hidden');
        document.getElementById('step1Talk').classList.add('hidden');
      }
    }

    function selectStep1Available(value, btn) {
      document.querySelectorAll('.step1-available-btn').forEach(b => {
        b.classList.remove('bg-blue-50', 'border-blue-300', 'text-blue-700');
        b.classList.add('bg-white', 'border-gray-200', 'text-gray-700');
      });
      btn.classList.remove('bg-white', 'border-gray-200', 'text-gray-700');
      btn.classList.add('bg-blue-50', 'border-blue-300', 'text-blue-700');

      if (value === 'yes') {
        document.getElementById('step1Talk').classList.remove('hidden');
        document.getElementById('step1AvailableResolution').classList.add('hidden');
      } else {
        document.getElementById('step1AvailableResolution').classList.remove('hidden');
        setDefaultCallbackDate();
      }
    }

    function selectStep1Talk(value, btn) {
      document.querySelectorAll('.step1-talk-btn').forEach(b => {
        b.classList.remove('bg-blue-50', 'border-blue-300', 'text-blue-700');
        b.classList.add('bg-white', 'border-gray-200', 'text-gray-700');
      });
      btn.classList.remove('bg-white', 'border-gray-200', 'text-gray-700');
      btn.classList.add('bg-blue-50', 'border-blue-300', 'text-blue-700');

      if (value === 'yes') {
        document.getElementById('step1TalkResolution').classList.add('hidden');
      } else {
        document.getElementById('step1TalkResolution').classList.remove('hidden');
        setDefaultCallbackDate();
      }
    }

    // Step 3: Identity verification
    function selectVerified(value, btn) {
      document.querySelectorAll('.verified-btn').forEach(b => {
        b.classList.remove('bg-blue-50', 'border-blue-300', 'text-blue-700');
        b.classList.add('bg-white', 'border-gray-200', 'text-gray-700');
      });
      btn.classList.remove('bg-white', 'border-gray-200', 'text-gray-700');
      btn.classList.add('bg-blue-50', 'border-blue-300', 'text-blue-700');

      if (value === 'yes') {
        document.getElementById('step3Resolution').classList.add('hidden');
      } else {
        document.getElementById('step3Resolution').classList.remove('hidden');
        setDefaultCallbackDate();
      }
    }

    // Step 9: Close call
    function selectCloseCall(value, btn) {
      document.querySelectorAll('.close-btn').forEach(b => {
        b.classList.remove('bg-blue-50', 'border-blue-300', 'text-blue-700');
        b.classList.add('bg-white', 'border-gray-200', 'text-gray-700');
      });
      btn.classList.remove('bg-white', 'border-gray-200', 'text-gray-700');
      btn.classList.add('bg-blue-50', 'border-blue-300', 'text-blue-700');
    }

    // Inline callback helpers
    function showInlineCallback(callbackId) {
      document.getElementById(callbackId).classList.remove('hidden');
      setDefaultCallbackDate();
    }

    function setDefaultCallbackDate() {
      const tomorrow = new Date();
      tomorrow.setDate(tomorrow.getDate() + 1);
      document.querySelectorAll('.inline-callback-date').forEach(input => {
        input.value = tomorrow.toISOString().split('T')[0];
      });
    }

    function selectLetter(value, btn) {
      document.getElementById('letterStatus').value = value;
      document.querySelectorAll('.letter-btn').forEach(b => {
        b.classList.remove('bg-blue-50', 'border-blue-300', 'text-blue-700');
        b.classList.add('bg-white', 'border-gray-200', 'text-gray-700');
      });
      btn.classList.remove('bg-white', 'border-gray-200', 'text-gray-700');
      btn.classList.add('bg-blue-50', 'border-blue-300', 'text-blue-700');
      checkResolveRequirements();
    }

    function selectFollowup(value, btn) {
      document.getElementById('followupPreference').value = value;
      document.querySelectorAll('.followup-btn').forEach(b => {
        b.classList.remove('bg-blue-50', 'border-blue-300', 'text-blue-700');
        b.classList.add('bg-white', 'border-gray-200', 'text-gray-700');
      });
      btn.classList.remove('bg-white', 'border-gray-200', 'text-gray-700');
      btn.classList.add('bg-blue-50', 'border-blue-300', 'text-blue-700');
      checkResolveRequirements();
    }

    function checkResolveRequirements() {
      const checks = document.querySelectorAll('.consent-check');
      const allChecked = document.querySelectorAll('.consent-check:checked').length === checks.length;
      const letterSelected = document.getElementById('letterStatus').value;
      const enrollmentSelected = document.getElementById('enrollmentSelected').value;
      const followupSelected = document.getElementById('followupPreference').value;
      const vitalsCompleted = document.getElementById('vitalsStatus').value === 'completed';
      const canResolve = allChecked && letterSelected && enrollmentSelected && followupSelected && vitalsCompleted;
      updateResolveButton(canResolve);
    }

    // Vitals Functions
    function sendVitalsLink() {
      document.getElementById('vitalsSendSection').classList.add('hidden');
      document.getElementById('vitalsWaitingSection').classList.remove('hidden');
      document.getElementById('vitalsStatus').value = 'waiting';
    }

    function refreshVitals() {
      // Simulate receiving results
      document.getElementById('vitalsWaitingSection').classList.add('hidden');
      document.getElementById('vitalsCompletedSection').classList.remove('hidden');
      document.getElementById('vitalsStatus').value = 'completed';
      checkResolveRequirements();
    }

    function resendVitals() {
      if (confirm('This will cancel the current vitals session and send a new link. Continue?')) {
        document.getElementById('vitalsWaitingSection').classList.add('hidden');
        document.getElementById('vitalsSendSection').classList.remove('hidden');
        document.getElementById('vitalsStatus').value = '';
        checkResolveRequirements();
      }
    }

    // Caretaker Toggle
    function toggleCaretakerFields() {
      const hasCaretaker = document.querySelector('input[name="hasCaretaker"][value="yes"]')?.checked;
      const fields = document.getElementById('caretakerFields');
      if (hasCaretaker) {
        fields.classList.remove('hidden');
      } else {
        fields.classList.add('hidden');
      }
    }

    function selectRelationship(value, btn) {
      document.querySelectorAll('.relationship-btn').forEach(b => {
        b.classList.remove('bg-blue-50', 'border-blue-300', 'text-blue-700');
        b.classList.add('bg-white', 'border-gray-200', 'text-gray-700');
      });
      btn.classList.remove('bg-white', 'border-gray-200', 'text-gray-700');
      btn.classList.add('bg-blue-50', 'border-blue-300', 'text-blue-700');
    }

    function updateResolveButton(canResolve) {
      const btn = document.getElementById('resolveBtn');
      const dropdownBtn = document.getElementById('resolveDropdownBtn');
      if (canResolve) {
        btn.disabled = false;
        btn.className = 'inline-flex items-center gap-1.5 px-4 py-2 bg-green-600 text-white text-xs font-medium rounded-l hover:bg-green-700 cursor-pointer';
        btn.title = '';
        dropdownBtn.className = 'px-2 py-2 bg-green-600 text-white text-xs font-medium rounded-r border-l border-green-700 hover:bg-green-700';
      } else {
        btn.disabled = true;
        btn.className = 'inline-flex items-center gap-1.5 px-4 py-2 bg-gray-300 text-gray-500 text-xs font-medium rounded-l cursor-not-allowed';
        btn.title = 'Complete required fields to mark as Consented';
        // Dropdown stays active for other resolution options
        dropdownBtn.className = 'px-2 py-2 bg-gray-700 text-white text-xs font-medium rounded-r border-l border-gray-600 hover:bg-gray-800';
      }
    }

    function toggleResolveDropdown() {
      const dropdown = document.getElementById('resolveDropdown');
      dropdown.classList.toggle('hidden');
    }

    function showCallbackPicker() {
      const picker = document.getElementById('callbackPicker');
      picker.classList.toggle('hidden');
      if (!picker.classList.contains('hidden')) {
        // Set default to tomorrow at 10am
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('callbackDate').value = tomorrow.toISOString().split('T')[0];
        document.getElementById('callbackTime').value = '10:00';
      }
    }

    function resolveAs(resolution) {
      if (resolution === 'callback') {
        const date = document.getElementById('callbackDate').value;
        const time = document.getElementById('callbackTime').value;
        if (!date || !time) {
          return;
        }
      }
      // In real app, would save to backend
      document.getElementById('resolveDropdown').classList.add('hidden');
      document.getElementById('callbackPicker')?.classList.add('hidden');
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      const dropdown = document.getElementById('resolveDropdown');
      if (!e.target.closest('.relative') && dropdown) {
        dropdown.classList.add('hidden');
      }
    });
  </script>

</body>
</html>
